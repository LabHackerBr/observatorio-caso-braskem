<?php
global $post;
$original_post = $post;
$post = $args['post'] ?? $post;

$image_size = $args['image_size'] ?? 'card-large';

$hide_author = (bool) ($args['hide_author'] ?? false);
$hide_categories = (bool) ($args['hide_categories'] ?? false);
$hide_date = (bool) ($args['hide_date'] ?? false);
$hide_excerpt = (bool) ($args['hide_excerpt'] ?? false);

$modifiers = (array) ($args['modifiers'] ?? []);
$modifiers = array_map(fn ($modifier) => "post-card--{$modifier}", $modifiers);
$modifiers = implode(' ', $modifiers);

$categories = get_the_category();
?>
<article id="post-ID-<?php the_ID(); ?>" class="post-card <?=$modifiers?>">
    <header class="post-card__image">
        <a href="<?php the_permalink();?>" aria-label="<?= esc_attr(get_the_title()) ?>">
            <?php if (has_post_thumbnail()): ?>
                <?php the_post_thumbnail($image_size); ?>
            <?php else: ?>
                <img src="<?= get_stylesheet_directory_uri() ?>/assets/images/placeholder.png" alt="">
            <?php endif; ?>
        </a>

        <?php if (!$hide_categories && !empty($categories)): ?>
            <div class="post-card__category">
                <?php foreach ($categories as $category): ?>
                    <a class="tag tag--solid tag--category-<?= $category->slug ?>" href="<?= get_term_link($category, 'category') ?>">
                        <?= $category->name ?>
                    </a>
                <?php endforeach; ?>
            </div>
        <?php endif; ?>

        <?php if (is_post_type_archive('biblioteca') ): ?>
        <div class="post-card-bilioteca__meta">

            <?php if (!$hide_date): ?>
            <time class="post-card__date">
                <?php echo get_the_date(); ?>
            </time>
            <?php endif; ?>
        </div>
        <?php endif; ?>

    </header>

    <main class="post-card__content">

        <?php if (is_home() && !$hide_categories && !empty($categories)): ?>
            <div class="post-card-news__category">
                <?php foreach ($categories as $category): ?>
                    <a class="tag tag--solid tag--category-<?= $category->slug ?>" href="<?= get_term_link($category, 'category') ?>">
                        <?= $category->name ?>
                    </a>
                <?php endforeach; ?>
            </div>
        <?php endif; ?>
        <h3 class="post-card__title">
            <a href="<?php the_permalink();?>"><?php the_title();?></a>
        </h3>

        <?php if (!$hide_author || !$hide_date): ?>
            <div class="post-card__meta">

                <?php if ( get_post_type() === 'biblioteca' ) : ?>
                    <?php
                    $midia = get_post_meta( get_the_ID(), 'tipo_de_midia', true );
                    if ( $midia ) :
                        ?>
                        <div class="post-card__midia">
                            <?php if ( $midia === 'Vídeo' ) : ?>
                                <svg xmlns="http://www.w3.org/2000/svg" width="25" height="29" viewBox="0 0 25 29" fill="none">
                                    <path d="M22.2428 0H2.75615C1.23643 0 0 1.2364 0 2.75615V17.4994C0 19.0191 1.2364 20.2556 2.75615 20.2556H22.2428C23.7625 20.2556 24.999 19.0192 24.999 17.4994L25 2.75615C25 1.23643 23.7636 0 22.2438 0H22.2428ZM23.3323 17.4994C23.3323 18.1004 22.8438 18.5889 22.2428 18.5889H2.75615C2.15514 18.5889 1.66662 18.1004 1.66662 17.4994V2.75615C1.66662 2.15514 2.15514 1.66662 2.75615 1.66662H22.2428C22.8438 1.66662 23.3323 2.15514 23.3323 2.75615V17.4994Z" fill="#222222"/>
                                    <path d="M17.1074 9.06276L10.441 4.89627C10.1837 4.73482 9.85975 4.72648 9.59517 4.87439C9.3306 5.02126 9.16602 5.30043 9.16602 5.60354V13.9365C9.16602 14.2396 9.33059 14.5178 9.59517 14.6657C9.72121 14.7355 9.85974 14.7698 9.99931 14.7698C10.1524 14.7698 10.3055 14.7271 10.4409 14.6427L17.1073 10.4763C17.3511 10.3242 17.499 10.0575 17.499 9.77005C17.499 9.48256 17.3511 9.21591 17.1073 9.06384L17.1074 9.06276ZM10.8327 12.4325V7.10551L15.093 9.76895L10.8327 12.4325Z" fill="#222222"/>
                                    <path d="M24.1656 25.0245H20.6793C20.3345 24.0568 19.4179 23.3579 18.3325 23.3579C17.2471 23.3579 16.3305 24.0568 15.9857 25.0245H0.833299C0.372891 25.0245 0 25.3974 0 25.8578C0 26.3182 0.372891 26.6911 0.833299 26.6911H15.9857C16.3305 27.6588 17.2471 28.3577 18.3325 28.3577C19.4179 28.3577 20.3345 27.6588 20.6793 26.6911H24.1656C24.626 26.6911 24.9988 26.3182 24.9988 25.8578C24.9988 25.3974 24.626 25.0245 24.1656 25.0245ZM18.3325 26.6911C17.8731 26.6911 17.4992 26.3172 17.4992 25.8578C17.4992 25.3984 17.8731 25.0245 18.3325 25.0245C18.7918 25.0245 19.1658 25.3984 19.1658 25.8578C19.1658 26.3172 18.7918 26.6911 18.3325 26.6911Z" fill="#222222"/>
                                </svg>
                            <?php elseif ( $midia === 'Texto' ) : ?>
                                <svg xmlns="http://www.w3.org/2000/svg" width="25" height="32" viewBox="0 0 25 32" fill="none">
                                    <path d="M20.4004 0.447266C20.6119 0.447266 20.8132 0.532203 20.9609 0.679688L24.7666 4.47754L24.8184 4.53516C24.9342 4.67602 25 4.85419 25 5.03906V27.9209C24.9999 28.3585 24.6435 28.7127 24.207 28.7129H22.2256V30.6895C22.2256 31.1271 21.8702 31.4813 21.4336 31.4814H0.792969C0.356298 31.4814 1.96169e-05 31.1272 0 30.6895V4.00879C0 3.57102 0.356285 3.21683 0.792969 3.2168H2.77344V1.24023C2.77346 0.802557 3.12983 0.447413 3.56641 0.447266H20.4004ZM1.58496 29.8975H20.6416L20.6396 28.7129H3.56641C3.12974 28.7129 2.77351 28.3586 2.77344 27.9209L2.77441 4.79883H1.58496V29.8975ZM4.35742 27.1299H23.4141V5.8291H20.4004C19.9676 5.82896 19.6094 5.47759 19.6094 5.03906V2.03223H4.35742V27.1299ZM21.8691 24.4219C22.054 24.422 22.23 24.4877 22.3701 24.6025L22.4287 24.6543L22.4814 24.7129C22.5979 24.8552 22.66 25.0327 22.6602 25.2139H22.6572C22.6572 25.4255 22.5733 25.6269 22.4258 25.7744C22.2748 25.9249 22.0721 26.0059 21.8652 26.0059H5.9043V26.0039C5.6978 26.0069 5.49374 25.9314 5.33984 25.7812C5.20624 25.6519 5.12249 25.4792 5.10352 25.2949L5.09863 25.2139L5.10352 25.1338C5.12251 24.9476 5.20668 24.7739 5.34277 24.6436L5.40234 24.5918C5.54384 24.4809 5.72066 24.4193 5.9043 24.4219H21.8691ZM21.8691 21.8984C22.0539 21.8986 22.23 21.9634 22.3701 22.0781L22.4287 22.1309L22.4814 22.1895C22.5979 22.3319 22.6601 22.5091 22.6602 22.6904H22.6572C22.6569 22.8961 22.5762 23.0967 22.4277 23.2451L22.4287 23.2461C22.4276 23.2472 22.426 23.2479 22.4248 23.249L22.4219 23.2529L22.4209 23.252C22.2719 23.4001 22.0708 23.4814 21.8652 23.4814H5.9043V23.4805C5.7206 23.4831 5.54386 23.4225 5.40234 23.3115L5.34277 23.2607C5.20722 23.1311 5.12274 22.9573 5.10352 22.7715L5.09863 22.6904L5.10352 22.6104C5.12243 22.4238 5.20641 22.2496 5.34277 22.1191L5.40234 22.0684C5.54388 21.9573 5.72056 21.8958 5.9043 21.8984H21.8691ZM21.8691 19.374C22.0537 19.3742 22.2291 19.4388 22.3682 19.5508L22.4258 19.6016L22.4287 19.6045L22.4824 19.665C22.5992 19.8085 22.66 19.9867 22.6602 20.166H22.6572C22.6569 20.3773 22.5732 20.5784 22.4258 20.7256C22.278 20.873 22.0767 20.957 21.8652 20.957H5.9043C5.49265 20.957 5.15642 20.6433 5.11621 20.2451L5.1123 20.165L5.11719 20.084C5.15785 19.6846 5.49495 19.374 5.9043 19.374H21.8691ZM21.8691 16.8486C22.054 16.8488 22.23 16.9145 22.3701 17.0293L22.4287 17.0811L22.4824 17.1406C22.6002 17.2854 22.6581 17.4636 22.6582 17.6406L22.6543 17.7197C22.636 17.9019 22.5548 18.0721 22.4258 18.2012C22.278 18.3485 22.0767 18.4326 21.8652 18.4326H5.9043C5.72061 18.4352 5.54386 18.3747 5.40234 18.2637L5.34277 18.2129C5.20587 18.0819 5.12234 17.9059 5.10352 17.7207L5.09863 17.6406L5.10352 17.5605C5.12253 17.3759 5.20628 17.201 5.34277 17.0703L5.40234 17.0186C5.54385 16.9076 5.72066 16.847 5.9043 16.8496L21.8691 16.8486ZM21.8691 14.3252C22.0539 14.3253 22.23 14.3902 22.3701 14.5049L22.4287 14.5576L22.4814 14.6162C22.5979 14.7586 22.6601 14.9359 22.6602 15.1172H22.6582C22.6582 15.3275 22.5736 15.5266 22.4277 15.6738L22.4287 15.6748C22.2791 15.8272 22.0738 15.9092 21.8652 15.9092H5.9043C5.72072 15.9118 5.54382 15.8511 5.40234 15.7402L5.34277 15.6875C5.20615 15.5566 5.12239 15.3822 5.10352 15.1973L5.09863 15.1172L5.10352 15.0371C5.12245 14.8521 5.20602 14.6768 5.34277 14.5459L5.40234 14.4951C5.54388 14.3841 5.72056 14.3226 5.9043 14.3252H21.8691ZM21.8691 11.8008C22.054 11.8009 22.23 11.8666 22.3701 11.9814L22.4287 12.0332L22.4814 12.0918C22.5978 12.2341 22.66 12.4116 22.6602 12.5928H22.6582C22.6582 12.8047 22.5736 13.0068 22.4258 13.1543L22.4219 13.1572C22.2753 13.3002 22.0761 13.3848 21.8652 13.3848H5.9043C5.49476 13.3848 5.15758 13.0735 5.11719 12.6738L5.1123 12.5928L5.11621 12.5127C5.15668 12.1148 5.49283 11.8008 5.9043 11.8008H21.8691ZM21.8701 9.27734C22.045 9.27743 22.2376 9.32552 22.3955 9.4541C22.5632 9.59076 22.6581 9.79233 22.6582 10.0176V10.0674C22.6582 10.2725 22.5761 10.4772 22.4248 10.627L22.4258 10.6279C22.278 10.7753 22.0767 10.8594 21.8652 10.8594H13.0859C12.6838 10.8472 12.36 10.5369 12.3213 10.1465L12.3184 10.0674L12.3213 9.98828C12.3605 9.59666 12.6861 9.28943 13.0859 9.27734H21.8701ZM10.9014 3.53809C11.339 3.53819 11.6922 3.89215 11.6924 4.33008V5.45508C11.6793 5.88242 11.329 6.22157 10.9014 6.22168C10.4761 6.22152 10.1226 5.88464 10.1094 5.45508V5.12109H9.19434V8.73535H9.35742L9.36426 8.73633C9.79508 8.74959 10.1297 9.10437 10.1299 9.52832C10.1297 9.95452 9.7928 10.3052 9.36426 10.3184L9.35742 10.3193H7.45508V10.3174C7.24622 10.3216 7.04312 10.2431 6.89355 10.0986C6.75688 9.96777 6.67321 9.79332 6.6543 9.6084L6.64941 9.52832L6.6543 9.44824C6.67054 9.28969 6.73478 9.13795 6.83887 9.01562L6.89355 8.95703C7.04469 8.81118 7.24862 8.73347 7.45508 8.73633L7.60938 8.73535V5.12109H6.69531V5.45508C6.68216 5.88359 6.33036 6.22162 5.90234 6.22168C5.47469 6.2216 5.12445 5.88244 5.11133 5.45508L5.09766 5.01074H5.1123V4.33008C5.11245 3.89209 5.46652 3.53809 5.9043 3.53809H10.9014ZM21.8701 6.75293C22.31 6.75318 22.659 7.11139 22.6592 7.54395C22.6591 7.7578 22.571 7.956 22.4277 8.10059H22.4287C22.2791 8.25311 22.0739 8.33594 21.8652 8.33594H13.0859C12.6839 8.32378 12.3601 8.01333 12.3213 7.62305L12.3184 7.54395L12.3213 7.46484C12.3604 7.07312 12.6861 6.76502 13.0859 6.75293H21.8701ZM17.9756 4.22949C18.184 4.22538 18.3858 4.30524 18.5352 4.44922C18.6914 4.59876 18.7801 4.80565 18.7803 5.01953C18.7803 5.23221 18.6926 5.43748 18.5381 5.58691L18.5391 5.58789C18.3877 5.7357 18.1834 5.81427 17.9756 5.81152H13.0986C12.8872 5.81142 12.6858 5.72747 12.5381 5.58008C12.409 5.45104 12.3278 5.28079 12.3096 5.09863L12.3066 5.01953L12.3096 4.94141C12.3278 4.75912 12.4089 4.58906 12.5381 4.45996L12.5967 4.4082C12.7356 4.29437 12.9119 4.22829 13.0986 4.22949H17.9756ZM21.1934 4.24512H22.292L21.1934 3.14844V4.24512Z" fill="#222222"/>
                                </svg>
                            <?php elseif ( $midia === 'Imagem' ) : ?>
                                <svg xmlns="http://www.w3.org/2000/svg" width="27" height="27" viewBox="0 0 27 27" fill="none">
                                    <path d="M4.53948 1H22.4605C23.4342 1 24.3194 1.39805 24.9607 2.03932C25.6019 2.68059 26 3.56585 26 4.53948V22.4605C26 23.4342 25.6019 24.3194 24.9607 24.9607C24.3194 25.6019 23.4342 26 22.4605 26H4.53948C3.56585 26 2.68059 25.6019 2.03932 24.9607C1.39805 24.3194 1 23.4342 1 22.4605V4.53948C1 3.56585 1.39805 2.68059 2.03932 2.03932C2.68059 1.39805 3.56585 1 4.53948 1ZM13.7315 17.1701L18.3228 12.5788C18.5519 12.3496 18.9226 12.3496 19.151 12.5788L24.827 18.2548V4.53948C24.827 3.88883 24.5603 3.29683 24.1309 2.86827C23.7016 2.43894 23.1096 2.17227 22.4597 2.17227H4.53869C3.88804 2.17227 3.29605 2.43894 2.86749 2.86827C2.43816 3.29761 2.17148 3.88961 2.17148 4.53948V18.7185L8.31043 12.5788C8.53957 12.3496 8.91025 12.3496 9.13861 12.5788L13.7299 17.1701H13.7315ZM24.8277 19.9119L18.7373 13.8214L14.5597 17.9982L17.0113 20.4499C17.2405 20.6791 17.2405 21.0497 17.0113 21.2781C16.7822 21.5072 16.4115 21.5072 16.1831 21.2781L13.317 18.4119L8.72569 13.8206L2.17227 20.3741V22.459C2.17227 23.1096 2.43894 23.7016 2.86827 24.1302C3.29761 24.5595 3.88961 24.8262 4.53948 24.8262H22.4605C23.1112 24.8262 23.7032 24.5595 24.1317 24.1302C24.5611 23.7008 24.8277 23.1088 24.8277 22.459V19.9103V19.9119ZM15.3393 5.74302C16.1824 5.74302 16.9448 6.08477 17.497 6.63689C18.0491 7.189 18.3908 7.95226 18.3908 8.79451C18.3908 9.63676 18.0491 10.4 17.497 10.9521C16.9448 11.5043 16.1824 11.846 15.3393 11.846C14.4971 11.846 13.7338 11.5043 13.1817 10.9521C12.6296 10.4 12.2878 9.63754 12.2878 8.79451C12.2878 7.95226 12.6296 7.189 13.1817 6.63689C13.7338 6.08477 14.4963 5.74302 15.3393 5.74302ZM16.6688 7.46506C16.3286 7.12487 15.8586 6.91451 15.3393 6.91451C14.8209 6.91451 14.3501 7.12487 14.0107 7.46506C13.6705 7.80524 13.4601 8.27524 13.4601 8.79451C13.4601 9.31378 13.6705 9.78378 14.0107 10.1232C14.3508 10.4634 14.8209 10.6737 15.3393 10.6737C15.8586 10.6737 16.3286 10.4634 16.6688 10.1232C17.009 9.783 17.2193 9.31378 17.2193 8.79451C17.2193 8.27524 17.009 7.80524 16.6688 7.46506Z" fill="#222222" stroke="#222222"/>
                                </svg>
                            <?php elseif ( $midia === 'Áudio' ) : ?>
                                <!-- SVG Áudio -->
                                <svg xmlns="http://www.w3.org/2000/svg" width="26" height="25" viewBox="0 0 26 25" fill="none">
                                    <path d="M13.8178 0.238955C13.1771 -0.152069 12.4249 -0.0600632 11.8584 0.491971L5.25594 6.85177H2.78583C1.25364 6.85177 0 8.40439 0 10.302V13.7522C0 15.6498 1.25364 17.2024 2.78583 17.2024H5.21879L11.7654 24.4134C12.1183 24.7929 12.5547 25 12.9912 25C13.2512 25 13.5112 24.931 13.762 24.793C14.4398 24.4135 14.8577 23.6084 14.8577 22.6883V2.29767C14.8577 1.41214 14.4585 0.630016 13.8178 0.238955ZM1.85731 13.7524V10.3022C1.85731 9.66961 2.27517 9.1521 2.78592 9.1521H4.64314V14.9025H2.78592C2.27517 14.9025 1.85731 14.3849 1.85731 13.7524ZM13.0006 22.6883L6.50036 15.5347V8.5651L13.0006 2.29731V22.6883ZM23.2154 21.8028C23.0668 21.8028 22.9089 21.7568 22.7604 21.6533C22.3146 21.3428 22.1475 20.6412 22.3982 20.0892C24.7197 14.9141 24.729 10.026 22.4075 5.12687C22.1475 4.57483 22.296 3.87331 22.7418 3.55129C23.1875 3.22927 23.7539 3.41328 24.0139 3.96531C26.6605 9.54307 26.6605 15.3394 24.0232 21.205C23.8561 21.5845 23.5404 21.7915 23.2061 21.7915L23.2154 21.8028ZM19.5009 19.5027C19.2966 19.5027 19.0923 19.4222 18.9252 19.2496C18.5259 18.8586 18.4609 18.1341 18.7766 17.6281C20.996 14.1893 20.996 10.9922 18.7766 7.56485C18.4609 7.0703 18.5259 6.34578 18.9252 5.94327C19.3245 5.54076 19.9095 5.63275 20.2345 6.12728C22.9646 10.3595 22.9646 14.8332 20.2345 19.0655C20.0488 19.353 19.7795 19.5025 19.5102 19.5025L19.5009 19.5027ZM16.7151 17.2025C16.4736 17.2025 16.2415 17.0875 16.0558 16.869C15.6936 16.4205 15.6936 15.6959 16.0558 15.2474C16.9286 14.1664 16.9286 11.0612 16.0558 9.9685C15.6936 9.51995 15.6936 8.79543 16.0558 8.34692C16.4179 7.89841 17.0029 7.89837 17.3651 8.34692C18.9716 10.3365 18.9716 14.8793 17.3651 16.8689C17.1794 17.0989 16.9472 17.2024 16.7058 17.2024L16.7151 17.2025Z" fill="#222222"/>
                                </svg>
                            <?php endif; ?>
                        </div>
                    <?php endif; ?>
                <?php endif; ?>

                <?php if ( ! $hide_author ) : ?>
                    <div class="post-card__author">
                        <span><?php _e('By', 'hacklabr') ?></span>
                        <?php
                            if ( get_post_type() === 'biblioteca' && function_exists('coauthors') ) {
                                coauthors(', ');
                            } else {
                                the_author();
                            }
                        ?>
                    </div>
                <?php endif; ?>

                <?php if ( ! $hide_date ) : ?>
                    <time class="post-card__date">
                        <?php
                        if ( is_author() ) {
                            echo get_the_date( 'd \d\e F \d\e Y' );
                        } else {
                            echo get_the_date();
                        }
                        ?>
                    </time>
                <?php endif; ?>

            </div>

        <?php endif; ?>

        <?php if (!$hide_excerpt): ?>
        <div class="post-card__excerpt">
            <?= get_the_excerpt(); ?>
        </div>
        <?php endif; ?>
    </main>
</article>

<?php
$post = $original_post;
