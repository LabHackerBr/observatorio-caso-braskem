<div class="archive-filters">
    <div class="archive-filters__selects">
        <details class="filter-ano">
            <summary>
                <div class="filter-title">
                <svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" viewBox="0 0 26 26" fill="none">
                        <path d="M26 7.64944V3.64443C25.9996 3.14355 25.8004 2.66331 25.4462 2.30913C25.0921 1.95496 24.6118 1.75579 24.1109 1.75536H21.3159V3.23411C21.3159 3.39573 21.2517 3.55073 21.1375 3.66501C21.0232 3.77929 20.8682 3.84349 20.7066 3.84349C20.5449 3.84349 20.3899 3.77929 20.2757 3.66501C20.1614 3.55073 20.0972 3.39573 20.0972 3.23411V1.75536H19.4318V1.17057C19.4317 1.02851 19.4882 0.892263 19.5886 0.791811C19.6891 0.691359 19.8253 0.634925 19.9674 0.634925C20.1095 0.634925 20.2457 0.691359 20.3461 0.791811C20.4466 0.892263 20.503 1.02851 20.503 1.17057V3.23452C20.503 3.28839 20.5244 3.34006 20.5625 3.37815C20.6006 3.41624 20.6523 3.43764 20.7062 3.43764C20.76 3.43764 20.8117 3.41624 20.8498 3.37815C20.8879 3.34006 20.9093 3.28839 20.9093 3.23452V1.17057C20.9093 0.920761 20.81 0.681187 20.6334 0.504549C20.4568 0.32791 20.2172 0.228675 19.9674 0.228675C19.7176 0.228675 19.478 0.32791 19.3014 0.504549C19.1247 0.681187 19.0255 0.920761 19.0255 1.17057V1.75536H16.4998V3.23411C16.4998 3.39573 16.4356 3.55073 16.3214 3.66501C16.2071 3.77929 16.0521 3.84349 15.8905 3.84349C15.7289 3.84349 15.5739 3.77929 15.4596 3.66501C15.3453 3.55073 15.2811 3.39573 15.2811 3.23411V1.75536H14.6163V1.17057C14.6163 1.02851 14.6727 0.892263 14.7732 0.791811C14.8736 0.691359 15.0098 0.634925 15.1519 0.634925C15.294 0.634925 15.4302 0.691359 15.5307 0.791811C15.6311 0.892263 15.6875 1.02851 15.6875 1.17057V3.23452C15.6875 3.28839 15.7089 3.34006 15.747 3.37815C15.7851 3.41624 15.8368 3.43764 15.8907 3.43764C15.9445 3.43764 15.9962 3.41624 16.0343 3.37815C16.0724 3.34006 16.0938 3.28839 16.0938 3.23452V1.17057C16.0938 0.920761 15.9946 0.681187 15.8179 0.504549C15.6413 0.32791 15.4017 0.228675 15.1519 0.228675C14.9021 0.228675 14.6625 0.32791 14.4859 0.504549C14.3093 0.681187 14.21 0.920761 14.21 1.17057V1.75536H11.6838V3.23411C11.6838 3.39573 11.6195 3.55073 11.5053 3.66501C11.391 3.77929 11.236 3.84349 11.0744 3.84349C10.9128 3.84349 10.7578 3.77929 10.6435 3.66501C10.5292 3.55073 10.465 3.39573 10.465 3.23411V1.75536H9.80078V1.17057C9.80078 1.02851 9.85721 0.892263 9.95767 0.791811C10.0581 0.691359 10.1944 0.634925 10.3364 0.634925C10.4785 0.634925 10.6147 0.691359 10.7152 0.791811C10.8156 0.892263 10.8721 1.02851 10.8721 1.17057V3.23452C10.8721 3.28839 10.8935 3.34006 10.9316 3.37815C10.9697 3.41624 11.0213 3.43764 11.0752 3.43764C11.1291 3.43764 11.1807 3.41624 11.2188 3.37815C11.2569 3.34006 11.2783 3.28839 11.2783 3.23452V1.17057C11.2783 0.920761 11.1791 0.681187 11.0024 0.504549C10.8258 0.32791 10.5862 0.228675 10.3364 0.228675C10.0866 0.228675 9.84704 0.32791 9.6704 0.504549C9.49377 0.681187 9.39453 0.920761 9.39453 1.17057V1.75536H6.86969V3.23411C6.86969 3.39573 6.80549 3.55073 6.69121 3.66501C6.57693 3.77929 6.42193 3.84349 6.26031 3.84349C6.0987 3.84349 5.9437 3.77929 5.82942 3.66501C5.71514 3.55073 5.65094 3.39573 5.65094 3.23411V1.75536H4.9855V1.17057C4.98411 1.09936 4.99694 1.02859 5.02323 0.962404C5.04952 0.896215 5.08875 0.835934 5.13861 0.785086C5.18848 0.734239 5.24799 0.693846 5.31365 0.666272C5.37932 0.638698 5.44982 0.624495 5.52104 0.624495C5.59226 0.624495 5.66276 0.638698 5.72843 0.666272C5.79409 0.693846 5.8536 0.734239 5.90346 0.785086C5.95333 0.835934 5.99256 0.896215 6.01885 0.962404C6.04514 1.02859 6.05796 1.09936 6.05658 1.17057V3.23452C6.05658 3.28839 6.07798 3.34006 6.11607 3.37815C6.15417 3.41624 6.20583 3.43764 6.2597 3.43764C6.31358 3.43764 6.36524 3.41624 6.40333 3.37815C6.44143 3.34006 6.46283 3.28839 6.46283 3.23452V1.17057C6.46466 1.04572 6.44166 0.921764 6.39515 0.805894C6.34864 0.690024 6.27956 0.584557 6.19193 0.495625C6.10429 0.406694 5.99985 0.336073 5.88468 0.28787C5.7695 0.239667 5.64589 0.214844 5.52104 0.214844C5.39618 0.214844 5.27258 0.239667 5.1574 0.28787C5.04223 0.336073 4.93778 0.406694 4.85015 0.495625C4.76251 0.584557 4.69343 0.690024 4.64693 0.805894C4.60042 0.921764 4.57742 1.04572 4.57925 1.17057V1.75536H1.88906C1.38818 1.75579 0.907944 1.95496 0.553769 2.30913C0.199594 2.66331 0.000430308 3.14355 0 3.64443L0 23.2088C0.000537677 23.7097 0.199736 24.1898 0.553887 24.544C0.908039 24.8981 1.38822 25.0973 1.88906 25.0979H24.1109C24.6118 25.0973 25.092 24.8981 25.4461 24.544C25.8003 24.1898 25.9995 23.7097 26 23.2088V7.64944ZM25.1875 23.065C25.1875 23.2252 25.156 23.3839 25.0947 23.532C25.0334 23.68 24.9435 23.8145 24.8302 23.9279C24.7169 24.0412 24.5823 24.131 24.4343 24.1923C24.2862 24.2537 24.1276 24.2852 23.9673 24.2852H2.03308C1.8728 24.2852 1.71408 24.2537 1.566 24.1923C1.41791 24.131 1.28336 24.0411 1.17001 23.9278C1.05667 23.8145 0.966757 23.6799 0.905415 23.5319C0.844073 23.3838 0.8125 23.2251 0.8125 23.0648V7.85317H25.1875V23.065Z" fill="#222222"/>
                        <path d="M17.2464 18.9761V21.9275C17.2464 21.9814 17.225 22.033 17.1869 22.0711C17.1488 22.1092 17.0972 22.1306 17.0433 22.1306H14.0898C14.036 22.1306 13.9843 22.1092 13.9462 22.0711C13.9081 22.033 13.8867 21.9814 13.8867 21.9275V18.9761C13.8867 18.9222 13.9081 18.8705 13.9462 18.8324C13.9843 18.7943 14.036 18.7729 14.0898 18.7729H17.0433C17.0972 18.7729 17.1488 18.7943 17.1869 18.8324C17.225 18.8705 17.2464 18.9222 17.2464 18.9761Z" fill="#222222"/>
                        <path d="M12.1195 9.85571V12.8092C12.1195 12.863 12.0981 12.9147 12.06 12.9528C12.0219 12.9909 11.9702 13.0123 11.9163 13.0123H8.96289C8.90902 13.0123 8.85735 12.9909 8.81926 12.9528C8.78117 12.9147 8.75977 12.863 8.75977 12.8092V9.85571C8.75977 9.80184 8.78117 9.75017 8.81926 9.71208C8.85735 9.67399 8.90902 9.65259 8.96289 9.65259H11.9163C11.9702 9.65259 12.0219 9.67399 12.06 9.71208C12.0981 9.75017 12.1195 9.80184 12.1195 9.85571Z" fill="#222222"/>
                        <path d="M12.1195 18.9761V21.9275C12.1197 21.9542 12.1147 21.9808 12.1045 22.0055C12.0944 22.0303 12.0795 22.0528 12.0606 22.0717C12.0416 22.0906 12.0191 22.1056 11.9944 22.1157C11.9696 22.1258 11.9431 22.1309 11.9163 22.1306H8.96289C8.90902 22.1306 8.85735 22.1092 8.81926 22.0711C8.78117 22.033 8.75977 21.9814 8.75977 21.9275V18.9761C8.75977 18.9222 8.78117 18.8705 8.81926 18.8325C8.85735 18.7944 8.90902 18.773 8.96289 18.773H11.9163C11.9431 18.7727 11.9696 18.7778 11.9944 18.7879C12.0191 18.798 12.0416 18.8129 12.0606 18.8318C12.0795 18.8508 12.0944 18.8733 12.1045 18.898C12.1147 18.9228 12.1197 18.9493 12.1195 18.9761Z" fill="#222222"/>
                        <path d="M6.78742 9.65259H3.83398C3.7218 9.65259 3.63086 9.74353 3.63086 9.85571V12.8092C3.63086 12.9213 3.7218 13.0123 3.83398 13.0123H6.78742C6.8996 13.0123 6.99055 12.9213 6.99055 12.8092V9.85571C6.99055 9.74353 6.8996 9.65259 6.78742 9.65259Z" fill="#222222"/>
                        <path d="M6.99055 18.9761V21.9275C6.99055 21.9814 6.96915 22.033 6.93105 22.0711C6.89296 22.1092 6.84129 22.1306 6.78742 22.1306H3.83398C3.78011 22.1306 3.72845 22.1092 3.69035 22.0711C3.65226 22.033 3.63086 21.9814 3.63086 21.9275V18.9761C3.63086 18.9222 3.65226 18.8705 3.69035 18.8324C3.72845 18.7943 3.78011 18.7729 3.83398 18.7729H6.78742C6.84129 18.7729 6.89296 18.7943 6.93105 18.8324C6.96915 18.8705 6.99055 18.9222 6.99055 18.9761Z" fill="#222222"/>
                        <path d="M17.0433 9.65259H14.0898C13.9777 9.65259 13.8867 9.74353 13.8867 9.85571V12.8092C13.8867 12.9213 13.9777 13.0123 14.0898 13.0123H17.0433C17.1555 13.0123 17.2464 12.9213 17.2464 12.8092V9.85571C17.2464 9.74353 17.1555 9.65259 17.0433 9.65259Z" fill="#222222"/>
                        <path d="M11.9163 14.2129H8.96289C8.85071 14.2129 8.75977 14.3038 8.75977 14.416V17.3695C8.75977 17.4816 8.85071 17.5726 8.96289 17.5726H11.9163C12.0285 17.5726 12.1195 17.4816 12.1195 17.3695V14.416C12.1195 14.3038 12.0285 14.2129 11.9163 14.2129Z" fill="#222222"/>
                        <path d="M6.78742 14.2129H3.83398C3.7218 14.2129 3.63086 14.3038 3.63086 14.416V17.3695C3.63086 17.4816 3.7218 17.5726 3.83398 17.5726H6.78742C6.8996 17.5726 6.99055 17.4816 6.99055 17.3695V14.416C6.99055 14.3038 6.8996 14.2129 6.78742 14.2129Z" fill="#222222"/>
                        <path d="M17.0433 14.2129H14.0898C13.9777 14.2129 13.8867 14.3038 13.8867 14.416V17.3695C13.8867 17.4816 13.9777 17.5726 14.0898 17.5726H17.0433C17.1555 17.5726 17.2464 17.4816 17.2464 17.3695V14.416C17.2464 14.3038 17.1555 14.2129 17.0433 14.2129Z" fill="#222222"/>
                        <path d="M22.1644 9.65259H19.2109C19.0988 9.65259 19.0078 9.74353 19.0078 9.85571V12.8092C19.0078 12.9213 19.0988 13.0123 19.2109 13.0123H22.1644C22.2766 13.0123 22.3675 12.9213 22.3675 12.8092V9.85571C22.3675 9.74353 22.2766 9.65259 22.1644 9.65259Z" fill="#222222"/>
                        <path d="M22.3675 18.9761V21.9275C22.3675 21.9814 22.3461 22.033 22.308 22.0711C22.2699 22.1092 22.2182 22.1306 22.1644 22.1306H19.2109C19.1571 22.1306 19.1054 22.1092 19.0673 22.0711C19.0292 22.033 19.0078 21.9814 19.0078 21.9275V18.9761C19.0078 18.9222 19.0292 18.8705 19.0673 18.8324C19.1054 18.7943 19.1571 18.7729 19.2109 18.7729H22.1644C22.2182 18.7729 22.2699 18.7943 22.308 18.8324C22.3461 18.8705 22.3675 18.9222 22.3675 18.9761Z" fill="#222222"/>
                        <path d="M22.1644 14.2129H19.2109C19.0988 14.2129 19.0078 14.3038 19.0078 14.416V17.3695C19.0078 17.4816 19.0988 17.5726 19.2109 17.5726H22.1644C22.2766 17.5726 22.3675 17.4816 22.3675 17.3695V14.416C22.3675 14.3038 22.2766 14.2129 22.1644 14.2129Z" fill="#222222"/>
                    </svg>
                    <?php
                        if ( ! empty($_GET['biblioteca_ano']) ) {
                            echo esc_html($_GET['biblioteca_ano']);
                        } else {
                            _e('Year', 'hacklabr');
                        }
                    ?>
                </div>
                <svg xmlns="http://www.w3.org/2000/svg" width="11" height="6" viewBox="0 0 11 6" fill="none">
                    <path d="M5.49416 5.6028C5.29621 5.81693 4.95777 5.81693 4.75983 5.6028L0.35666 0.839397C0.0606761 0.519197 0.287779 -1.20697e-07 0.723824 -7.90303e-08L9.53016 7.6246e-07C9.9662 8.04126e-07 10.1933 0.519198 9.89732 0.839398L5.49416 5.6028Z" fill="#222222"/>
                </svg>
            </summary>
            <ul>
                <?php
                global $wpdb;
                $datas = $wpdb->get_col($wpdb->prepare(
                    "SELECT pm.meta_value
                    FROM {$wpdb->postmeta} pm
                    INNER JOIN {$wpdb->posts} p ON p.ID = pm.post_id
                    WHERE pm.meta_key = %s
                    AND p.post_type = %s
                    AND p.post_status = 'publish'",
                    'ano', 'biblioteca'
                ));

                $anos = [];
                foreach ($datas as $data) {
                    if (strtotime($data)) {
                        $y = date('Y', strtotime($data));
                        if (!in_array($y, $anos)) $anos[] = $y;
                    }
                }
                rsort($anos);

                foreach ($anos as $ano) :
                    $args = $_GET;
                    $args['biblioteca_ano'] = $ano;
                    unset($args['paged']);
                    $link = add_query_arg($args, get_post_type_archive_link('biblioteca'));
                ?>
                    <li>
                        <a href="<?php echo esc_url($link); ?>" <?php echo (($_GET['biblioteca_ano'] ?? '') == $ano) ? 'class="active"' : ''; ?>>
                            <?php echo esc_html($ano); ?>
                        </a>
                    </li>
                <?php endforeach; ?>
            </ul>
        </details>

        <?php
        $posts = get_posts([
            'post_type'      => 'biblioteca',
            'posts_per_page' => -1,
            'post_status'    => 'publish',
        ]);

        $unique_authors = [];

        foreach ($posts as $p) {
            $coauthors = get_coauthors($p->ID);
            foreach ($coauthors as $author) {
                if ($author->type === 'guest-author' && !isset($unique_authors[$author->user_nicename])) {
                    $unique_authors[$author->user_nicename] = $author;
                }
            }
        }

        usort($unique_authors, function($a, $b) {
            return strcmp($a->display_name, $b->display_name);
        });
        ?>

        <details class="filter-authors">
            <summary>
                <div class="filter-title">
                    <svg xmlns="http://www.w3.org/2000/svg" width="25" height="29" viewBox="0 0 25 29" fill="none">
                        <path fill-rule="evenodd" clip-rule="evenodd" d="M2.23464 20.0947L1.08397 22.3977C1.05214 22.4705 1.02654 22.5327 1.01082 22.5852L0.644275 24.4899C0.631663 24.6471 0.818015 24.7213 0.911041 24.5984L2.35229 23.0092L2.34499 23.0075C2.39611 22.9511 2.44339 22.8778 2.49843 22.7703L3.55825 20.7667C3.55825 20.7667 7.96683 20.09 10.7452 19.1639C13.5272 18.2385 17.7509 12.7283 17.7509 12.7283L14.3193 12.6465L18.3098 11.3791C18.7145 11.2508 18.977 10.9383 19.2853 10.5762L24.5281 4.40904C4.15214 1.57073 1.09658 17.657 2.23464 20.0947ZM4.66406 18.2895L3.53196 19.0729C5.86703 13.4386 12.5997 6.75312 20.3963 5.8604C9.43391 9.43935 4.67738 18.2646 4.66406 18.2895Z" fill="#222222"/>
                    </svg>
                    <?php
                    if ( ! empty($_GET['biblioteca_coautor']) ) {
                        $author_post = get_page_by_path( sanitize_text_field($_GET['biblioteca_coautor']), OBJECT, 'guest-author' );
                        if ( $author_post ) {
                            echo esc_html($author_post->post_title);
                        } else {
                            echo esc_html($_GET['biblioteca_coautor']);
                        }
                    } else {
                        _e('Authorship', 'hacklabr');
                    }
                    ?>
                </div>
                <svg xmlns="http://www.w3.org/2000/svg" width="11" height="6" viewBox="0 0 11 6" fill="none">
                    <path d="M5.49416 5.6028C5.29621 5.81693 4.95777 5.81693 4.75983 5.6028L0.35666 0.839397C0.0606761 0.519197 0.287779 -1.20697e-07 0.723824 -7.90303e-08L9.53016 7.6246e-07C9.9662 8.04126e-07 10.1933 0.519198 9.89732 0.839398L5.49416 5.6028Z" fill="#222222"/>
                </svg>
            </summary>
            <ul>
                <?php foreach ($unique_authors as $ga) :
                    $args = $_GET;
                    $args['biblioteca_coautor'] = $ga->user_nicename;
                    unset($args['paged']);
                    $link = add_query_arg($args, get_post_type_archive_link('biblioteca'));
                    $selected = (($_GET['biblioteca_coautor'] ?? '') === $ga->user_nicename);
                ?>
                    <li>
                        <a href="<?php echo esc_url($link); ?>" class="<?php echo $selected ? 'active' : ''; ?>">
                            <?php echo esc_html($ga->display_name); ?>
                        </a>
                    </li>
                <?php endforeach; ?>
            </ul>
        </details>

        <details class="filter-midia">
            <summary>
            <div class="filter-title">
                <svg xmlns="http://www.w3.org/2000/svg" width="23" height="22" viewBox="0 0 23 22" fill="none">
                    <path d="M21.2668 0H7.29019C6.33323 0 5.55696 0.773051 5.55696 1.71697V2.31202H4.04348C3.14401 2.31202 2.41193 3.03726 2.41193 3.92827V4.63112C2.38728 4.62298 2.35751 4.62298 2.32876 4.62298H1.63466C0.735185 4.62298 0 5.34719 0 6.23822V18.6394C0 20.4947 1.52376 22 3.39664 22H19.238C21.3121 22 23 20.3278 23 18.2733V1.71704C23 0.773116 22.2238 0 21.2668 0ZM9.54103 16.9947C8.73398 16.9825 8.72886 15.7874 9.54103 15.7741H19.0202C19.8272 15.7884 19.8313 16.9795 19.0202 16.9947H9.54103ZM8.92495 12.7959C8.92495 12.4582 9.20013 12.1856 9.54103 12.1856H19.0202C19.357 12.1856 19.6363 12.4582 19.6363 12.7959C19.6363 13.1336 19.357 13.4062 19.0202 13.4062H9.54103C9.20013 13.4062 8.92495 13.1336 8.92495 12.7959ZM19.0202 9.81756H9.54109C8.73404 9.80535 8.72891 8.6102 9.54109 8.59697H19.0202C19.8263 8.61121 19.8314 9.8023 19.0202 9.81756ZM11.7055 5.61457C11.7055 5.28096 11.9806 5.00426 12.3215 5.00426H16.2357C16.5766 5.00426 16.8518 5.28093 16.8518 5.61457C16.8518 5.95227 16.5766 6.22488 16.2357 6.22488H12.3215C11.9806 6.22488 11.7055 5.95227 11.7055 5.61457ZM3.3968 20.7782C2.20162 20.7782 1.23233 19.818 1.23233 18.6381V6.23696C1.23233 6.02132 1.41304 5.84231 1.63482 5.84231C1.67897 5.83621 2.39258 5.8535 2.41209 5.83417V18.9209C2.41209 19.2576 2.6883 19.5313 3.02817 19.5313C3.36804 19.5313 3.64425 19.2576 3.64425 18.9209V3.9281C3.64425 3.71043 3.82394 3.53244 4.04366 3.53244H5.55714V18.6383C5.55714 19.8182 4.58788 20.7782 3.3968 20.7782Z" fill="#222222"/>
                </svg>
                <?php
                    if ( ! empty($_GET['biblioteca_midia']) ) {
                        echo esc_html($_GET['biblioteca_midia']);
                    } else {
                        _e('Media type', 'hacklabr');
                    }
                ?>

            </div>
                <svg xmlns="http://www.w3.org/2000/svg" width="11" height="6" viewBox="0 0 11 6" fill="none">
                    <path d="M5.49416 5.6028C5.29621 5.81693 4.95777 5.81693 4.75983 5.6028L0.35666 0.839397C0.0606761 0.519197 0.287779 -1.20697e-07 0.723824 -7.90303e-08L9.53016 7.6246e-07C9.9662 8.04126e-07 10.1933 0.519198 9.89732 0.839398L5.49416 5.6028Z" fill="#222222"/>
                </svg>
            </summary>
            <ul>
                <?php
                $midias = ['Vídeo','Texto','Imagem','Áudio'];
                foreach ($midias as $midia) :
                    $args = $_GET;
                    $args['biblioteca_midia'] = $midia;
                    unset($args['paged']);
                    $link = add_query_arg($args, get_post_type_archive_link('biblioteca'));
                    $selected = (($_GET['biblioteca_midia'] ?? '') === $midia);
                ?>
                    <li>
                        <a href="<?php echo esc_url($link); ?>" class="<?php echo $selected ? 'active' : ''; ?>">
                            <?php echo esc_html($midia); ?>
                        </a>
                    </li>
                <?php endforeach; ?>
            </ul>
        </details>

        <details class="filter-instancia">
            <summary>
            <div class="filter-title">
                <svg xmlns="http://www.w3.org/2000/svg" width="23" height="23" viewBox="0 0 23 23" fill="none">
                    <path d="M21.125 17.7474V4.65259C22.0687 4.32129 22.75 3.44155 22.75 2.4C22.75 1.07656 21.6566 0 20.3125 0C19.2547 0 18.3612 0.670801 18.0247 1.6H4.72528C4.38881 0.670801 3.49533 0 2.4375 0C1.09338 0 0 1.07656 0 2.4C0 3.44155 0.681282 4.32124 1.625 4.65254V17.7474C0.681282 18.0787 0 18.9584 0 20C0 21.3234 1.09338 22.4 2.4375 22.4C3.49533 22.4 4.38881 21.7292 4.72528 20.8H18.0248C18.3612 21.7292 19.2547 22.4 20.3125 22.4C21.6566 22.4 22.75 21.3234 22.75 20C22.75 18.9584 22.0687 18.0787 21.125 17.7474ZM19.5 17.7474C18.8117 17.9891 18.2701 18.5223 18.0247 19.2H4.72528C4.47986 18.5223 3.93832 17.9891 3.25 17.7474V4.65259C3.93832 4.41094 4.47986 3.87773 4.72528 3.2H18.0248C18.2702 3.87773 18.8117 4.41089 19.5 4.65254V17.7474Z" fill="#222222"/>
                    <path d="M17.0625 5.6001H5.6875C4.79005 5.6001 4.0625 6.31646 4.0625 7.2001V8.8001H18.6875V7.2001C18.6875 6.31646 17.9599 5.6001 17.0625 5.6001ZM12.1875 7.6001C12.1875 7.82119 12.0058 8.0001 11.7812 8.0001C11.5567 8.0001 11.375 7.82119 11.375 7.6001V6.8001C11.375 6.579 11.5567 6.4001 11.7812 6.4001C12.0058 6.4001 12.1875 6.579 12.1875 6.8001V7.6001ZM13.8125 7.6001C13.8125 7.82119 13.6308 8.0001 13.4062 8.0001C13.1817 8.0001 13 7.82119 13 7.6001V6.8001C13 6.579 13.1817 6.4001 13.4062 6.4001C13.6308 6.4001 13.8125 6.579 13.8125 6.8001V7.6001ZM15.4375 7.6001C15.4375 7.82119 15.2558 8.0001 15.0312 8.0001C14.8067 8.0001 14.625 7.82119 14.625 7.6001V6.8001C14.625 6.579 14.8067 6.4001 15.0312 6.4001C15.2558 6.4001 15.4375 6.579 15.4375 6.8001V7.6001ZM17.0625 7.6001C17.0625 7.82119 16.8808 8.0001 16.6562 8.0001C16.4317 8.0001 16.25 7.82119 16.25 7.6001V6.8001C16.25 6.579 16.4317 6.4001 16.6562 6.4001C16.8808 6.4001 17.0625 6.579 17.0625 6.8001V7.6001Z" fill="#222222"/>
                    <path d="M4.0625 15.2001C4.0625 16.0837 4.79005 16.8001 5.6875 16.8001H17.0625C17.9599 16.8001 18.6875 16.0837 18.6875 15.2001V13.6001H4.0625V15.2001ZM16.25 14.8001C16.25 14.579 16.4317 14.4001 16.6562 14.4001C16.8808 14.4001 17.0625 14.579 17.0625 14.8001V15.6001C17.0625 15.8212 16.8808 16.0001 16.6562 16.0001C16.4317 16.0001 16.25 15.8212 16.25 15.6001V14.8001ZM14.625 14.8001C14.625 14.579 14.8067 14.4001 15.0312 14.4001C15.2558 14.4001 15.4375 14.579 15.4375 14.8001V15.6001C15.4375 15.8212 15.2558 16.0001 15.0312 16.0001C14.8067 16.0001 14.625 15.8212 14.625 15.6001V14.8001ZM13 14.8001C13 14.579 13.1817 14.4001 13.4062 14.4001C13.6308 14.4001 13.8125 14.579 13.8125 14.8001V15.6001C13.8125 15.8212 13.6308 16.0001 13.4062 16.0001C13.1817 16.0001 13 15.8212 13 15.6001V14.8001ZM11.375 14.8001C11.375 14.579 11.5567 14.4001 11.7812 14.4001C12.0058 14.4001 12.1875 14.579 12.1875 14.8001V15.6001C12.1875 15.8212 12.0058 16.0001 11.7812 16.0001C11.5567 16.0001 11.375 15.8212 11.375 15.6001V14.8001Z" fill="#222222"/>
                    <path d="M4.0625 12.8001H18.6875V9.6001H4.0625V12.8001ZM16.25 10.8001C16.25 10.579 16.4317 10.4001 16.6562 10.4001C16.8808 10.4001 17.0625 10.579 17.0625 10.8001V11.6001C17.0625 11.8212 16.8808 12.0001 16.6562 12.0001C16.4317 12.0001 16.25 11.8212 16.25 11.6001V10.8001ZM14.625 10.8001C14.625 10.579 14.8067 10.4001 15.0312 10.4001C15.2558 10.4001 15.4375 10.579 15.4375 10.8001V11.6001C15.4375 11.8212 15.2558 12.0001 15.0312 12.0001C14.8067 12.0001 14.625 11.8212 14.625 11.6001V10.8001ZM13 10.8001C13 10.579 13.1817 10.4001 13.4062 10.4001C13.6308 10.4001 13.8125 10.579 13.8125 10.8001V11.6001C13.8125 11.8212 13.6308 12.0001 13.4062 12.0001C13.1817 12.0001 13 11.8212 13 11.6001V10.8001ZM11.375 10.8001C11.375 10.579 11.5567 10.4001 11.7812 10.4001C12.0058 10.4001 12.1875 10.579 12.1875 10.8001V11.6001C12.1875 11.8212 12.0058 12.0001 11.7812 12.0001C11.5567 12.0001 11.375 11.8212 11.375 11.6001V10.8001Z" fill="#222222"/>
                </svg>
                <?php
                    if ( ! empty($_GET['biblioteca_instancia']) ) {
                        echo esc_html($_GET['biblioteca_instancia']);
                    } else {
                        _e('Instance', 'hacklabr');
                    }
                ?>

            </div>
                <svg xmlns="http://www.w3.org/2000/svg" width="11" height="6" viewBox="0 0 11 6" fill="none">
                    <path d="M5.49416 5.6028C5.29621 5.81693 4.95777 5.81693 4.75983 5.6028L0.35666 0.839397C0.0606761 0.519197 0.287779 -1.20697e-07 0.723824 -7.90303e-08L9.53016 7.6246e-07C9.9662 8.04126e-07 10.1933 0.519198 9.89732 0.839398L5.49416 5.6028Z" fill="#222222"/>
                </svg>
            </summary>
            <ul>
                <?php
                $instancias = ['Municipal','Estadual','Federal'];
                foreach ($instancias as $inst) :
                    $args = $_GET;
                    $args['biblioteca_instancia'] = $inst;
                    unset($args['paged']);
                    $link = add_query_arg($args, get_post_type_archive_link('biblioteca'));
                    $selected = (($_GET['biblioteca_instancia'] ?? '') === $inst);
                ?>
                    <li>
                        <a href="<?php echo esc_url($link); ?>" class="<?php echo $selected ? 'active' : ''; ?>">
                            <?php echo esc_html($inst); ?>
                        </a>
                    </li>
                <?php endforeach; ?>
            </ul>
        </details>

        <details class="filter-classe">
            <summary>
            <div class="filter-title">
                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="24" viewBox="0 0 32 24" fill="none">
                    <path d="M12.3641 0C11.9627 0 11.6368 0.315816 11.6368 0.705911V7.76453C11.6368 8.15463 11.9627 8.47044 12.3641 8.47044H15.2734V11.2941H4.36398C3.96205 11.2941 3.63665 11.6099 3.63665 12V15.5296H0.72733C0.325398 15.5296 0 15.8459 0 16.2355V23.2941C0 23.6837 0.325398 24 0.72733 24H8.00013C8.40155 24 8.72746 23.6837 8.72746 23.2941V16.2355C8.72746 15.8454 8.40206 15.5296 8.00013 15.5296H5.09081V12.7064H15.2729V15.5296H12.3636C11.9622 15.5296 11.6363 15.8459 11.6363 16.2355V23.2941C11.6363 23.6837 11.9622 24 12.3636 24H19.6364C20.0378 24 20.3637 23.6837 20.3637 23.2941V16.2355C20.3637 15.8454 20.0378 15.5296 19.6364 15.5296H16.7271V12.7064H26.9092V15.5296H23.9999C23.5984 15.5296 23.2725 15.8459 23.2725 16.2355V23.2941C23.2725 23.6837 23.5979 24 23.9999 24H31.2727C31.6746 24 32 23.6837 32 23.2941V16.2355C32 15.8454 31.6746 15.5296 31.2727 15.5296H28.3633V12C28.3633 11.6104 28.0379 11.2941 27.636 11.2941H16.7266V8.47044H19.6359C20.0373 8.47044 20.3632 8.15463 20.3632 7.76453V0.705911C20.3632 0.316307 20.0373 0 19.6359 0H12.3641ZM2.90881 17.6468H5.81814V19.0586H2.90881V17.6468ZM14.5456 17.6468H17.4544V19.0586H14.5456V17.6468ZM26.1824 17.6468H29.0917V19.0586H26.1824V17.6468Z" fill="#222222"/>
                </svg>
                <?php
                    if ( ! empty($_GET['biblioteca_classe']) ) {
                        echo esc_html($_GET['biblioteca_classe']);
                    } else {
                        _e('Class', 'hacklabr');
                    }
                ?>
            </div>
                <svg xmlns="http://www.w3.org/2000/svg" width="11" height="6" viewBox="0 0 11 6" fill="none">
                    <path d="M5.49416 5.6028C5.29621 5.81693 4.95777 5.81693 4.75983 5.6028L0.35666 0.839397C0.0606761 0.519197 0.287779 -1.20697e-07 0.723824 -7.90303e-08L9.53016 7.6246e-07C9.9662 8.04126e-07 10.1933 0.519198 9.89732 0.839398L5.49416 5.6028Z" fill="#222222"/>
                </svg>
            </summary>
            <ul>
                <?php
                $tipos = get_terms([
                    'taxonomy'   => 'classe',
                    'hide_empty' => true,
                ]);
                foreach ($tipos as $tipo) :
                    $args = $_GET;
                    $args['biblioteca_classe'] = $tipo->slug;
                    unset($args['paged']);
                    $link = add_query_arg($args, get_post_type_archive_link('biblioteca'));
                    $selected = (($_GET['biblioteca_classe'] ?? '') === $tipo->slug);
                ?>
                    <li>
                        <a href="<?php echo esc_url($link); ?>" class="<?php echo $selected ? 'active' : ''; ?>">
                            <?php echo esc_html($tipo->name); ?>
                        </a>
                    </li>
                <?php endforeach; ?>
            </ul>
        </details>
    </div>

    <div class="archive-filters__checkbox">
        <label>
            <input type="checkbox" id="filter-cpi" name="relacionado_cpi">
            <?php _e('Only documents related to the CPI','hacklabr');?>
        </label>
    </div>
</div>

</div>

<div class="archive-active-filters container container--wide">
    <div class="actve-terms">
    <?php $has_filters = false; ?>

    <?php
    $filters = [
        'biblioteca_search'   => __('Search', 'hacklabr'),
        'biblioteca_ano'      => __('Year', 'hacklabr'),
        'biblioteca_coautor'  => __('Co-author', 'hacklabr'),
        'biblioteca_midia'    => __('Media', 'hacklabr'),
        'biblioteca_instancia'=> __('Instance', 'hacklabr'),
        'biblioteca_classe'=> __('Class', 'hacklabr')
    ];

    foreach ($filters as $key => $label) :
        if (!empty($_GET[$key])) :
            $has_filters = true;
            $value = $_GET[$key];

            if ($key === 'biblioteca_coautor') {
                $ga = get_page_by_path(sanitize_text_field($value), OBJECT, 'guest-author');
                $value = $ga ? $ga->post_title : $value;
            }

            if ($key === 'biblioteca_classe') {
                $term = get_term_by('slug', $value, 'classe');
                $value = $term ? $term->name : $value;
            }
            ?>
            <span class="active-filter">
                <?php echo esc_html($value); ?>
                <?php
                $args = $_GET;
                unset($args[$key], $args['paged']);
                ?>
                <a href="<?php echo esc_url(add_query_arg($args, get_post_type_archive_link('biblioteca'))); ?>" class="clear-filter">×</a>
            </span>
        <?php endif;
    endforeach;
    ?>
    </div>

    <?php if ($has_filters) : ?>
        <span class="active-filter clear-all">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="17" viewBox="0 0 16 17" fill="none">
                    <path d="M1.66289 0C0.264458 0 -0.512583 1.66926 0.382709 2.78157L5.2773 8.86261V16.4333C5.2773 16.6404 5.3873 16.831 5.56415 16.9304C5.74103 17.0299 5.9566 17.0222 6.12636 16.9106L10.4685 14.0546C10.6269 13.9504 10.7227 13.7705 10.7227 13.5773V8.86261L15.6173 2.78157C16.5126 1.66926 15.7355 0 14.3371 0H1.66289Z" fill="white"/>
            </svg>
            <a href="<?php echo esc_url(get_post_type_archive_link('biblioteca')); ?>">
                <?php _e('Clear all filters', 'hacklabr'); ?>
            </a>
        </span>
    <?php endif; ?>

</div>
<script>
document.addEventListener('DOMContentLoaded', function() {
    const checkboxCpi = document.querySelector('#filter-cpi');

    const urlParams = new URLSearchParams(window.location.search);
    if(urlParams.get('relacionado_cpi') === '1') {
        checkboxCpi.checked = true;
    }

    checkboxCpi.addEventListener('change', function() {
        const params = new URLSearchParams(window.location.search);

        if(this.checked) {
            params.set('relacionado_cpi', '1');
        } else {
            params.delete('relacionado_cpi');
        }

        window.location.search = params.toString();
    });
});
</script>
<script>
document.addEventListener("DOMContentLoaded", function() {
  const filters = document.querySelectorAll(".archive-filters details");

  filters.forEach((filter) => {
    filter.addEventListener("toggle", function() {
      if (filter.open) {
        filters.forEach((other) => {
          if (other !== filter) {
            other.removeAttribute("open");
          }
        });
      }
    });

    filter.querySelectorAll("a").forEach((link) => {
      link.addEventListener("click", function() {
        filter.removeAttribute("open");
      });
    });
  });
});
</script>

